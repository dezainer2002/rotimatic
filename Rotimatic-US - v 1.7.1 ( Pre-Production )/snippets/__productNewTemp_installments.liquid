{%-liquid
assign splitIt  =     '<svg class="splititIcon" xmlns="http://www.w3.org/2000/svg" width="118" height="35" viewBox="0 0 118 35" fill="none"><path d="M2.30185 31.582C2.92674 32.0951 3.59152 32.5812 4.30948 32.9998C11.3428 37.118 20.3306 34.674 24.3858 27.5313C28.4409 20.3885 26.0344 11.2609 19.0011 7.14268C18.2831 6.72411 17.5386 6.37304 16.794 6.08949L2.30185 31.582Z" fill="#642F6C"/><path d="M24.0668 3.41618C23.4419 2.90309 22.7771 2.417 22.0591 1.99843C15.0258 -2.1198 6.03797 0.337633 1.96953 7.46689C-2.08562 14.6097 0.320875 23.7373 7.35423 27.8555C8.07219 28.2741 8.81675 28.6251 9.5613 28.9087L24.0668 3.41618Z" fill="white"/><path d="M2.30185 31.582C2.92674 32.0951 3.59152 32.5812 4.30948 32.9998C11.3428 37.118 20.3306 34.674 24.3858 27.5313C28.4409 20.3885 26.0344 11.2609 19.0011 7.14268C18.2831 6.72411 17.5386 6.37304 16.794 6.08949L2.30185 31.582Z" fill="#642F6C"/><path d="M24.0668 3.41618C23.4419 2.90309 22.7771 2.417 22.0591 1.99843C15.0258 -2.1198 6.03797 0.337633 1.96953 7.46689C-2.08562 14.6097 0.320875 23.7373 7.35423 27.8555C8.07219 28.2741 8.81675 28.6251 9.5613 28.9087L24.0668 3.41618Z" fill="#A77BCA"/><path d="M11.635 34.9983C9.13543 34.9983 6.60927 34.3502 4.29584 32.9999C3.57788 32.5813 2.9131 32.1088 2.28821 31.5822L5.25312 26.3838C5.9046 26.9374 6.59597 27.4369 7.35382 27.869C8.07178 28.2876 8.81633 28.6386 9.56089 28.9222L21.1014 8.62811C24.4918 11.5176 26.3532 15.7439 26.3532 20.0916C26.3532 22.6166 25.715 25.182 24.3855 27.545C21.6599 32.3248 16.7139 34.9983 11.635 34.9983Z" fill="#642F6C"/><path d="M9.56106 28.9221C8.80321 28.6386 8.07196 28.2875 7.354 27.8689C6.59615 27.4234 5.90478 26.9238 5.2533 26.3837L16.7939 6.07608C17.5517 6.35963 18.283 6.71069 19.0009 7.12927C19.7588 7.57485 20.4501 8.07443 21.1016 8.61453L9.56106 28.9221Z" fill="#A77BCA"/><g style="mix-blend-mode:multiply"><path d="M9.56106 28.9221C8.80321 28.6386 8.07196 28.2875 7.354 27.8689C6.59615 27.4234 5.90478 26.9238 5.2533 26.3837L16.7939 6.07608C17.5517 6.35963 18.283 6.71069 19.0009 7.12927C19.7588 7.57485 20.4501 8.07443 21.1016 8.61453L9.56106 28.9221Z" fill="#642F6C"/></g><path d="M39.45 26.7617C36.6313 26.7617 33.9988 25.9515 32.164 24.9658L32.8155 20.7531C34.9029 22.0763 37.469 22.873 39.4899 22.873C41.0056 22.873 41.7235 22.3599 41.7235 21.5227C41.7235 20.6046 41.2183 20.1995 38.732 19.5784C34.2913 18.4037 32.4166 17.202 32.4166 13.8264C32.4166 10.4913 34.8763 8.24988 39.1974 8.24988C41.5773 8.24988 43.8907 8.72246 45.7255 9.57311L45.0341 13.7859C43.1196 12.7192 40.9258 12.0981 39.224 12.0981C37.921 12.0981 37.3493 12.5706 37.3493 13.2728C37.3493 14.0019 37.8545 14.407 40.3408 15.1091C45.0341 16.3918 46.6961 17.607 46.6961 20.9421C46.6961 24.7093 44.1433 26.7617 39.45 26.7617Z" fill="#231F20"/><path d="M58.5822 26.6403C57 26.6403 55.8699 26.3432 54.8594 26.0191V32.4328L49.4082 33.2699V8.50655H54.2079L54.5669 10.883C55.7901 9.49222 57.3856 8.12848 59.6591 8.12848C63.3021 8.12848 66.0144 10.91 66.0144 16.9995C66.0144 23.8183 62.4778 26.6403 58.5822 26.6403ZM57.8908 13.0839C56.6942 13.0839 55.7635 13.813 54.8594 14.9202V21.7389C55.6173 22.1035 56.2289 22.2925 57.3457 22.2925C59.1805 22.2925 60.5632 20.8612 60.5632 17.3776C60.5632 14.3666 59.4464 13.0839 57.8908 13.0839Z" fill="#231F20"/><path d="M68.9391 26.4647V0.877655L74.4169 0V26.4647H68.9391Z" fill="#231F20"/><path d="M78.3926 26.4647V8.5065H83.8837V26.4647H78.3926Z" fill="#231F20"/><path d="M95.3576 26.7211C91.5683 26.7211 88.9358 25.3304 88.9358 20.7531V13.0162H86.5958V8.50642H88.9358V3.14597L94.3471 2.30882V8.50642H97.6976L98.389 13.0162H94.3471V19.8754C94.3471 21.3472 95.0385 21.9953 96.5143 21.9953C96.9796 21.9953 97.4184 21.9278 97.8173 21.8063L98.5086 26.3566C97.6311 26.6131 96.7935 26.7211 95.3576 26.7211Z" fill="#231F20"/><path d="M102.218 26.4646V9.12753H104.558V26.4646H102.218Z" fill="#A77BCA"/><path d="M115.633 26.7616C112.961 26.7616 111.192 25.695 111.192 22.5084V11.1799H108.56V9.12753H111.192V3.11897L113.533 2.7139V9.12753H117.468L117.787 11.1799H113.533V22.1033C113.533 23.8586 114.224 24.6283 116.059 24.6283C116.604 24.6283 117.255 24.5203 117.641 24.4392L118 26.4511C117.508 26.6131 116.644 26.7616 115.633 26.7616Z" fill="#A77BCA"/><path d="M81.1576 5.14433C79.9876 5.14433 79.0037 4.15865 79.0037 2.98395C79.0037 1.80924 79.9876 0.823563 81.1576 0.823563C82.3276 0.823563 83.2583 1.80924 83.2583 2.98395C83.2583 4.15865 82.3143 5.14433 81.1576 5.14433Z" fill="#231F20"/><path d="M103.415 4.94178C102.351 4.94178 101.46 4.03712 101.46 2.98394C101.46 1.91725 102.351 1.02609 103.415 1.02609C104.479 1.02609 105.329 1.93075 105.329 2.98394C105.329 4.05063 104.465 4.94178 103.415 4.94178Z" fill="#A77BCA"/></svg>'
assign klarna   =     '<svg width="53" height="12" viewBox="0 0 53 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M51.4901 8.88636C51.0885 8.88785 50.7039 9.04965 50.421 9.33616C50.138 9.62267 49.9799 10.0104 49.9813 10.4142V10.4178C49.9802 10.6178 50.0183 10.816 50.0935 11.0012C50.1687 11.1864 50.2794 11.3549 50.4194 11.497C50.5594 11.6392 50.7259 11.7522 50.9093 11.8296C51.0928 11.9071 51.2896 11.9474 51.4886 11.9484H51.4914C52.3235 11.9484 53 11.2627 53 10.4178C53.0012 10.2176 52.9631 10.0192 52.8879 9.83383C52.8128 9.64849 52.702 9.47987 52.5619 9.33763C52.4218 9.19538 52.2552 9.08231 52.0716 9.00487C51.888 8.92744 51.691 8.88716 51.4919 8.88636H51.4901ZM46.5252 7.705C46.5252 6.54702 45.55 5.60938 44.347 5.60938C43.144 5.60938 42.1688 6.5483 42.1688 7.705C42.1688 8.8617 43.1455 9.79934 44.3485 9.79934C45.5516 9.79934 46.5252 8.8617 46.5252 7.705ZM46.5336 3.63164H48.9371V11.7758H46.5339V11.2552C45.8331 11.7411 45.0018 12.0009 44.1506 12C41.8112 12 39.9145 10.0767 39.9145 7.70346C39.9145 5.33022 41.8109 3.40667 44.1503 3.40667C45.0017 3.40512 45.8332 3.66496 46.5336 4.15144V3.63164ZM27.2963 4.69306V3.63215H24.8351V11.7758H27.3019V7.97286C27.3019 6.68878 28.6718 6.00103 29.6229 6.00103H29.6513V3.63215C28.6754 3.63215 27.7797 4.05616 27.2983 4.69203L27.2963 4.69306ZM21.1669 7.70398C21.1669 6.54599 20.1918 5.60835 18.9887 5.60835C17.7857 5.60835 16.8106 6.54728 16.8106 7.70398C16.8106 8.86068 17.7872 9.79831 18.9903 9.79831C20.1933 9.79831 21.1669 8.86068 21.1669 7.70398ZM21.1754 3.63061H23.5799V11.7758H21.1754V11.2552C20.4746 11.7411 19.6433 12.0009 18.792 12C16.4526 12 14.556 10.0767 14.556 7.70346C14.556 5.33022 16.4516 3.40667 18.791 3.40667C19.6424 3.40512 20.4739 3.66496 21.1743 4.15144L21.1754 3.63061ZM35.644 3.41309C34.6844 3.41309 33.7757 3.71459 33.1659 4.54847V3.63215H30.7728V11.7758H33.196V7.49621C33.196 6.25861 34.0135 5.65099 35.0004 5.65099C36.0563 5.65099 36.6649 6.29123 36.6649 7.47926V11.7758H39.065V6.5971C39.065 4.70205 37.5792 3.41257 35.643 3.41257L35.644 3.41309ZM11.0537 11.7758H13.5698V0.0028246H11.0537V11.7758ZM0 11.7789H2.66512V0H0.00153279L0 11.7789ZM9.32129 0C9.32129 2.54942 8.34179 4.92265 6.59536 6.68544L10.278 11.7789H6.98803L2.98626 6.24423L4.01966 5.45889C4.86069 4.82299 5.54212 3.99817 6.00949 3.05033C6.47686 2.10248 6.71721 1.05788 6.71135 0H9.32129Z" fill="#0A0B09"/></svg>'

capture installmentSec
  capture getInstallmentData
    section 'product-installment'
  endcapture

  capture getCollection
    assign getCollection__1   =   getInstallmentData | split: 'selected-collection="^^^^^' | last
    assign getCollection__2   =   getCollection__1 | split: '^^^^^"' | first
    echo getCollection__2
  endcapture

  assign collection__             =   collections[getCollection]
  assign string__currency__code   =   'currency__' | append: currentCurrency
  assign vCurrency_Count          =   0
  assign isSelected               =   ''
  assign collectionProducts       =   collection__.products | sort: 'title-ascending'

  paginate collection__.products by 250

    for pro in collectionProducts

      for tag in pro.tags

        if tag contains string__currency__code

          if vCurrency_Count == 0
            assign firstVariant       =   pro.selected_or_first_available_variant
            assign priceForKlarna     =   firstVariant.price
            assign vCurrency_Count    =   vCurrency_Count | plus: 1
          elsif vCurrency_Count == 1
            assign lastVariant        =   pro.selected_or_first_available_variant
            assign vCurrency_Count    =   vCurrency_Count | plus: 1
          endif

        endif

      endfor

    endfor

  endpaginate

  capture installmentContent
    if getInstallmentData contains 'installment-content="^'
      assign numberOfInstallments_01    =   getInstallmentData | split: 'installment-content="^' | last
      assign numberOfInstallments_01    =   numberOfInstallments_01 | split: '^_installmentContent' | first
      if numberOfInstallments_01 != blank
        echo numberOfInstallments_01
      endif
    endif
  endcapture

  capture numberOfInstallments
    if getInstallmentData contains 'number-of-installments="^'
      assign numberOfInstallments_02    =   getInstallmentData | split: 'number-of-installments="^' | last
      assign numberOfInstallments_02    =   numberOfInstallments_02 | split: '^_installments' | first
      if numberOfInstallments_02 != blank
        echo numberOfInstallments_02
      endif
    endif
  endcapture

  capture splititContent
    if getInstallmentData contains 'splitit-content="^'
      assign numberOfInstallments_03    =   getInstallmentData | split: 'splitit-content="^' | last
      assign numberOfInstallments_03    =   numberOfInstallments_03 | split: '^_splitit' | first
      if numberOfInstallments_03 != blank
        echo numberOfInstallments_03
      endif
    endif
  endcapture

  capture klarnaContent
    if getInstallmentData contains 'klarna-content="^'
      assign numberOfInstallments_04    =   getInstallmentData | split: 'klarna-content="^' | last
      assign numberOfInstallments_04    =   numberOfInstallments_04 | split: '^_klarna' | first
      if numberOfInstallments_04 != blank
        echo numberOfInstallments_04
      endif
    endif
  endcapture

endcapture

if viewAs == 'html'

  echo '<div class="afterAdd2Cart__Installment">'

    if currentCurrency == 'USD'
      comment
        echo '<style>.afterAdd2Cart__Installment{max-width: 100% !important;}</style>'
      endcomment
      echo '<klarna-placement data-key="credit-promotion-badge" data-locale="en-US" data-purchase-amount="' | append: priceForKlarna | append: '"></klarna-placement>'
    endif

    comment
      echo '<div class="_InstallmentGrid_">'
        echo '<div class="_icon_" loading>'
          echo klarna
        echo '</div>'
        echo '<div class="_content_" loading>'
          echo klarnaContent
        echo '</div>'
      echo '</div>'
    endcomment

    if currentCurrency == 'DKK' or currentCurrency == 'EUR' or currentCurrency == 'NOK' or currentCurrency == 'QAR'
      assign firstVariantSplitIt_price    =   firstVariant.price | money_without_currency | remove: '.' | split: ',' | first
    else
      assign firstVariantSplitIt_price    =   firstVariant.price | money_without_currency | remove: ','
    endif
    echo '<div class="_InstallmentGrid_" data-splitit="true" data-splitit-amount="' | append: firstVariantSplitIt_price | append: '" data-splitit-content="custom" vid="' | append: firstVariant.id | append: '" style="display: grid;">'
      echo '<div class="_icon_" data-splitit-custom="learn-more">'
        echo splitIt
      echo '</div>'
      echo '<div class="_content_" data-splitit-custom="learn-more">'
        echo splititContent
      echo '</div>'
    echo '</div>'

    assign lastVariantSplitIt_price    =   lastVariant.price | money_without_currency | remove: ','
    echo '<div class="_InstallmentGrid_" data-splitit="true" data-splitit-amount="' | append: lastVariantSplitIt_price | append: '" data-splitit-content="custom" vid="' | append: lastVariant.id | append: '" style="display: none;">'
      echo '<div class="_icon_" data-splitit-custom="learn-more">'
        echo splitIt
      echo '</div>'
      echo '<div class="_content_" data-splitit-custom="learn-more">'
        echo splititContent
      echo '</div>'
    echo '</div>'

  echo '</div>'

elsif viewAs == 'json'

  if dataIs == 'klarnaContent'
    echo klarnaContent
  elsif dataIs == 'splitItContent'
    echo splititContent
  elsif dataIs == 'numberOfInstallments'
    echo numberOfInstallments
  elsif dataIs == 'installmentContent'
    echo installmentContent
  endif

endif
-%}
